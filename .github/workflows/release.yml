name: Release Binaries

on:
    release:
        types: [published]

jobs:
    build:
        runs-on: ubuntu-latest

        strategy:
            matrix:
                platform:
                    - windows/amd64
                    - linux/amd64
                    - darwin/amd64
                    - darwin/arm64

        steps:
            - name: Checkout Code
              uses: actions/checkout@v3

            - name: Set up Go
              uses: actions/setup-go@v4
              with:
                  go-version: 1.23

            - name: Build Binary
              env:
                  GOOS: ${{ steps.platform-vars.outputs.os }}
                  GOARCH: ${{ steps.platform-vars.outputs.arch }}
                  OUTPUT_NAME: todo-${{ matrix.platform }}
              run: |
                  if [[ "$GOOS" == "windows" ]]; then OUTPUT_NAME+=".exe"; fi
                  go build -o "$OUTPUT_NAME"

            - name: Set Platform Variables
              id: platform-vars
              run: |
                  os=$(echo "${{ matrix.platform }}" | cut -d'/' -f1)
                  arch=$(echo "${{ matrix.platform }}" | cut -d'/' -f2)
                  echo "os=$os" >> $GITHUB_OUTPUT
                  echo "arch=$arch" >> $GITHUB_OUTPUT

            - name: Upload Binary
              uses: actions/upload-artifact@v3
              with:
                  name: ${{ matrix.platform }}
                  path: todo-${{ matrix.platform }}*
